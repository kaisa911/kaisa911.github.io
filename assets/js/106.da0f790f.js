(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{683:function(s,t,a){"use strict";a.r(t);var n=a(17),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("Monorepo 这个东西，感觉已经听说了好久了，也仅仅的停留在了解这是个啥，但是却从来没有体验过，趁着闲下来这一段时间，研究了一下，来感受一下新技术带来的快感。")]),s._v(" "),a("h2",{attrs:{id:"什么是-pnpm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-pnpm"}},[s._v("#")]),s._v(" 什么是 pnpm")]),s._v(" "),a("p",[s._v("pnpm(performance npm) 就是一个高效率的 npm，一个包管理器。它是由 npm/yarn 衍生而来，但解决了 npm/yarn 内部潜在的一些问题，提升了速度，提高了安全性，扩展了使用场景。pnpm 支持 monorepo，可以使用 pnpm 来搭建 monorepo 项目")]),s._v(" "),a("h2",{attrs:{id:"什么是-monorepo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-monorepo"}},[s._v("#")]),s._v(" 什么是 monorepo")]),s._v(" "),a("p",[s._v("Monorepo 是管理项目代码的一个方式，指在一个项目仓库 (repo) 中管理多个模块/包 (package)，不同于常见的每个模块建一个repo。")]),s._v(" "),a("p",[s._v("在整个项目里，会有项目整体的依赖，每个模块也会有自己的依赖，可以减轻整个项目的依赖关系。同时，也可以把某些模块整体的安装到另外的模块中，避免了多个 repo 的代码和版本差异等。")]),s._v(" "),a("h2",{attrs:{id:"开始"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始"}},[s._v("#")]),s._v(" 开始")]),s._v(" "),a("h3",{attrs:{id:"安装-pnpm-和创建项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-pnpm-和创建项目"}},[s._v("#")]),s._v(" 安装 pnpm 和创建项目")]),s._v(" "),a("p",[s._v("首先要用 pnpm，就需要安装一下")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" -g\n")])])]),a("p",[s._v("简单的安装一下，就可以使用 pnpm 来安装依赖了")]),s._v(" "),a("p",[s._v("创建项目，在 root 目录下创建一个 pnpm-workspace.yaml 的文件")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" monorepo-demo\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" monorepo-demo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" pnpm-workspace.yaml\n\n")])])]),a("p",[s._v("在 pnpm-workspace.yaml 中添加配置，把所有相关的包放在 packages 里面，test 里一般放单测的内容，就不放在里面了")]),s._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("packages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有在 packages/  子目录下的 package")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'packages/**'")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不包括在 test 文件夹下的 package")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'!**/test/**'")]),s._v("\n")])])]),a("p",[s._v("在root目录下，可以创建packages目录，用来存放每个模块，创建几个模块，比如（utils，user，login等），用来处理不同的模块，然后分别pnpm init他们，给他们的name改成@projectName/name（比如@monorepo/utils）一定要有name，方便在外层安装依赖等")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mkdir packages\ncd packages\nmkdir utils user login\n")])])]),a("h3",{attrs:{id:"安装依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖"}},[s._v("#")]),s._v(" 安装依赖")]),s._v(" "),a("p",[s._v("安装公用依赖，全局依赖可以安装在root目录下，可以使用")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" i vue@^3.0.0 -w "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -w 是 workspace")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" i vue@^3.0.0 -r "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -r 是 root")]),s._v("\n\n")])])]),a("p",[s._v("如果想安装在某个模块的局部依赖，可以有两种方法：")]),s._v(" "),a("ol",[a("li",[s._v("直接 cd 打开某个模块，或者vscode打开该模块文件夹，在该模块里面安装相应的依赖")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" i axios -S\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("在根目录使用"),a("code",[s._v("--filter")]),s._v("来过滤name")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" i axios -S --filter @monorepo/login\n")])])]),a("h3",{attrs:{id:"模块引用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块引用"}},[s._v("#")]),s._v(" 模块引用")]),s._v(" "),a("p",[s._v("如果有一个模块，你想在其他模块中使用，比如你有一个公共的组件，或者公共的工具库，也可以直接在模块中安装使用")]),s._v(" "),a("p",[s._v("比如在@monorepo/utils模块里init，创建index.js")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" init\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" index.js\n")])])]),a("p",[s._v("并在index.js里添加一些方法")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("add")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("subtract")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" add"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" subtract "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("然后在根目录执行")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" i @monorepo/utils -r --filter @monorepo/login\n")])])]),a("p",[s._v("就会在login的package.json里发现多了一个依赖，因为是workspace负责管理的，所以会现实由workspace安装而来")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@monorepo/demo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"main"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"main.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"start"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vite"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"keywords"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"author"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"license"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ISC"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"less"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^4.1.3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"@monorepo/utils"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"workspace:^1.0.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// workspace ")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"view-ui-plus"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^1.3.0"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("然后就可以在项目里直接使用了")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" utils "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@monorepo/utils'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// { add: f, substract: f }")]),s._v("\n")])])]),a("p",[s._v("这样就几乎已经完成了这个monorepo的搭建了，在项目中，就可以把原来src中的一些模块，拆分出来，把公用的依赖放到root目录下，把公用模块按需安装到其他模块中，就可以正常开发了。")]),s._v(" "),a("h2",{attrs:{id:"开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开发"}},[s._v("#")]),s._v(" 开发")]),s._v(" "),a("p",[s._v("在开发中，只需要打开某一个模块，单独开发，也可以，这样就可以暂时剥离了monorepo的概念。也可以在根目录下，cd到模块目录开发。效果都是一样的")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/kaisa911/monorepo-demo",target:"_blank",rel:"noopener noreferrer"}},[s._v("Github地址"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=r.exports}}]);